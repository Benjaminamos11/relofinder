---
import Layout from '../../layouts/Layout.astro';
import CloudinaryImage from '../../components/common/CloudinaryImage.astro';
import { getCollection } from 'astro:content';
import { ArrowRight, Clock, User, TrendingUp } from 'lucide-react';

// Get and sort blog posts
const allBlogPosts = await getCollection('blog');
const blogPosts = allBlogPosts.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime());

// Featured Post (First one)
const featuredPost = blogPosts[0];
const remainingPosts = blogPosts.slice(1);

// Format date helper
function formatDate(date: Date) {
  return new Date(date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
}

const title = 'ReloFinder Journal | Swiss Relocation Guides';
const description = 'Expert insights, cultural guides, and practical advice for settling in Switzerland.';
const canonical = 'https://relofinder.ch/blog';
---

<Layout title={title} description={description} canonical={canonical}>
  
  <main class="bg-white min-h-screen pt-24 pb-20">
    <div class="container mx-auto px-6 lg:px-8 max-w-7xl">

      <!-- Header -->
      <header class="mb-16 border-b border-gray-100 pb-12">
        <h1 class="text-7xl md:text-8xl font-serif text-gray-900 mb-6 tracking-tight">
          The Journal
        </h1>
        <p class="text-xl text-gray-500 max-w-2xl font-light leading-relaxed">
          Curated insights on Swiss culture, relocation logistics, and settling in. 
          Written by experts, designed for global citizens.
        </p>
      </header>

      {/* Featured Article - Magazine Style Hero */}
      {featuredPost && (
        <section class="mb-24 group cursor-pointer block">
          <a href={`/blog/${featuredPost.slug}`} class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12 items-center">
            
            {/* Image Side */}
            <div class="lg:col-span-8 relative overflow-hidden rounded-2xl aspect-[16/9] lg:aspect-[21/9]">
               <div class="absolute inset-0 bg-gray-200 animate-pulse"></div>
               {featuredPost.data.heroImage && (
                  <div class="w-full h-full transition-transform duration-700 group-hover:scale-105">
                     <CloudinaryImage
                        src={featuredPost.data.heroImage}
                        alt={featuredPost.data.title}
                        width={1200}
                        height={600}
                        class="w-full h-full object-cover filter grayscale group-hover:grayscale-0 transition-all duration-700"
                     />
                  </div>
               )}
               <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent opacity-60"></div>
               <div class="absolute top-6 left-6 grid gap-2">
                  <span class="bg-white/90 backdrop-blur-md text-gray-900 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider w-fit">
                    Editor's Pick
                  </span>
                  {featuredPost.data.category && (
                    <span class="bg-[#FF6F61] text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider w-fit">
                      {featuredPost.data.category}
                    </span>
                  )}
               </div>
            </div>

            {/* Content Side */}
            <div class="lg:col-span-4 flex flex-col justify-center">
               <div class="flex items-center gap-3 text-sm text-gray-400 mb-4 font-medium uppercase tracking-widest">
                  <span class="text-[#FF6F61]">{formatDate(featuredPost.data.publishDate)}</span>
                  <span>—</span>
                  <span>{featuredPost.data.readingTime || '5'} min read</span>
               </div>
               <h2 class="text-4xl lg:text-5xl font-serif text-gray-900 mb-6 leading-tight group-hover:text-[#FF6F61] transition-colors duration-300">
                  {featuredPost.data.title}
               </h2>
               <p class="text-gray-500 text-lg leading-relaxed mb-8 line-clamp-3">
                  {featuredPost.data.description}
               </p>
               <div class="flex items-center gap-2 text-sm font-bold text-gray-900 uppercase tracking-wider group/link">
                  Read Story <ArrowRight className="w-4 h-4 transition-transform group-hover/link:translate-x-1 text-[#FF6F61]" />
               </div>
            </div>
          </a>
        </section>
      )}

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 border-t border-gray-100 pt-16">
        
        {/* Main Feed */}
        <div class="lg:col-span-8">
           <div class="flex items-center justify-between mb-10">
              <h3 class="text-2xl font-serif text-gray-900 italic">Latest Stories</h3>
              <div class="h-px bg-gray-200 flex-1 ml-6"></div>
           </div>

           <div class="grid gap-12">
              {remainingPosts.map(post => (
                <article class="group relative grid md:grid-cols-2 gap-8 items-center cursor-pointer">
                  <a href={`/blog/${post.slug}`} class="absolute inset-0 z-10"></a>
                  
                  {/* Thumbnail */}
                  <div class="relative aspect-[4/3] overflow-hidden rounded-xl bg-gray-100">
                     {post.data.heroImage && (
                        <CloudinaryImage
                           src={post.data.heroImage}
                           alt={post.data.title}
                           width={600}
                           height={450}
                           class="w-full h-full object-cover filter grayscale group-hover:grayscale-0 transition-all duration-500"
                        />
                     )}
                     <div class="absolute inset-0 ring-1 ring-inset ring-black/5 rounded-xl"></div>
                  </div>

                  {/* Content */}
                  <div>
                     <div class="flex items-center gap-3 text-xs text-gray-400 mb-3 font-bold uppercase tracking-widest">
                        {post.data.category && <span class="text-[#FF6F61]">{post.data.category}</span>}
                        <span>•</span>
                        <span>{formatDate(post.data.publishDate)}</span>
                     </div>
                     <h4 class="text-2xl font-serif text-gray-900 mb-3 leading-snug group-hover:text-[#FF6F61] transition-colors">
                        {post.data.title}
                     </h4>
                     <p class="text-gray-500 text-sm leading-relaxed mb-5 line-clamp-2">
                        {post.data.description}
                     </p>
                     
                     <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center">
                           <User className="w-4 h-4 text-gray-400" />
                        </div>
                        <span class="text-xs font-medium text-gray-900">{post.data.author || 'Editorial Team'}</span>
                     </div>
                  </div>
                </article>
              ))}
              
              {remainingPosts.length === 0 && (
                 <div class="py-20 text-center bg-gray-50 rounded-2xl">
                    <p class="text-gray-500 italic font-serif">More stories coming soon...</p>
                 </div>
              )}
           </div>
        </div>

        {/* Sidebar */}
        <aside class="lg:col-span-4 space-y-12">
           
           {/* Trending Section */}
           <div class="bg-gray-50 p-8 rounded-2xl">
              <div class="flex items-center gap-2 mb-6 text-gray-900 font-bold uppercase tracking-widest text-xs">
                 <TrendingUp className="w-4 h-4 text-[#FF6F61]" />
                 Trending Now
              </div>
              <ul class="space-y-6">
                 {blogPosts.slice(0, 4).map((item, i) => (
                    <li class="group cursor-pointer">
                       <a href={`/blog/${item.slug}`}>
                          <span class="text-xs font-bold text-gray-300 mb-1 block">0{i + 1}</span>
                          <h5 class="text-lg font-serif text-gray-900 group-hover:text-[#FF6F61] transition-colors leading-snug mb-1">
                             {item.data.title}
                          </h5>
                          <span class="text-xs text-gray-400 font-medium">{item.data.readingTime || '5'} min read</span>
                       </a>
                    </li>
                 ))}
              </ul>
           </div>

           {/* Newsletter */}
           <div class="border border-gray-200 p-8 rounded-2xl text-center">
              <h4 class="font-serif text-2xl text-gray-900 mb-3">Weekly Briefing</h4>
              <p class="text-sm text-gray-500 mb-6 leading-relaxed">
                 Join 5,000+ expats receiving the best relocation tips every Thursday.
              </p>
              <form class="space-y-3" onclick="event.preventDefault()">
                 <input 
                    type="email" 
                    placeholder="Your email address" 
                    class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-[#FF6F61] transition-colors"
                 />
                 <button class="w-full bg-[#FF6F61] hover:bg-[#ff5a4d] text-white font-bold text-sm uppercase tracking-widest py-3 rounded-lg transition-colors">
                    Subscribe
                 </button>
              </form>
              <p class="text-[10px] text-gray-400 mt-4">Unsubscribe at any time.</p>
           </div>

        </aside>

      </div>

    </div>
  </main>
</Layout>
