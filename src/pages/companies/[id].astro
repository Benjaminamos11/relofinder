---
import Layout from '../../layouts/Layout.astro';
import SchemaMarkup from '../../components/common/SchemaMarkup.astro';
import { getCollection } from 'astro:content';
import { marked } from 'marked';
import { fetchGoogleReviews, getMockReviews, type FormattedReview, type BusinessReviewData } from '../../utils/google-reviews';

// Generate static paths for all companies
export async function getStaticPaths() {
  const companies = await getCollection('companies');
  return companies.map((company: any) => ({
    params: { id: (company as any).data.id },
    props: { company },
  }));
}

// Get company data from props
const { company } = Astro.props;
const companyData = (company as any).data;

// Get related services and regions
const services = await getCollection('services');
const regions = await getCollection('regions');
const blogPosts = await getCollection('blog');

const companyServices = services.filter((service: any) => 
  companyData.services.includes(service.data.id)
);

const companyRegions = regions.filter((region: any) => 
  companyData.regions.includes(region.data.id)
);

// Get featured blog posts related to this company's services
const featuredPosts = blogPosts
  .filter((post: any) => 
    companyData.services.some((service: string) => 
      post.data.title.toLowerCase().includes(service.replace('-', ' ')) ||
      post.data.tags?.some((tag: string) => tag.toLowerCase().includes(service.replace('-', ' ')))
    )
  )
  .slice(0, 4);

// Content processing
const { Content } = await company.render();

// Reviews data
const mockReviews = getMockReviews();
let reviewsData: BusinessReviewData = {
  rating: 4.5,
  reviewCount: 50,
  reviews: mockReviews,
  businessInfo: {
    address: '',
    placeId: ''
  }
};

try {
  const apiKey = import.meta.env.SERPAPI_KEY;
  if (apiKey && companyData.googleMyBusinessUrl) {
    const fetchedReviews = await fetchGoogleReviews(companyData.googleMyBusinessUrl, apiKey);
    if (fetchedReviews) {
      reviewsData = fetchedReviews;
    }
  }
} catch (error) {
  console.log('Error fetching Google reviews:', error);
}

const actualRating = companyData.rating?.score || reviewsData.rating || 4.5;
const actualReviewCount = companyData.rating?.reviews || reviewsData.reviewCount || 50;
const reviewsToDisplay = reviewsData.reviews || [];

// SEO setup optimized to outrank the company
const title = `${companyData.name} Reviews & Analysis 2025 | Swiss Relocation Expert | ReloFinder.ch`;
const description = `Detailed ${companyData.name} review: ${actualRating}/5 rating from ${actualReviewCount} verified clients. Expert analysis, pricing insights, and comparison with other Swiss relocation companies. ${companyData.specializations.slice(0,2).join(' & ')} specialist across ${companyData.regions.slice(0,3).join(', ')}.`;

// Contact control system
const showDirectContact = companyData.featured || companyData.contactSettings?.showDirectContact || false;
const showWebsite = companyData.contactSettings?.showWebsite !== false;
const showPhone = companyData.contactSettings?.showPhone || showDirectContact;
const showEmail = companyData.contactSettings?.showEmail || showDirectContact;

// Sample Q&A data (will be moved to CMS)
const faqs = [
  {
    question: `How much does ${companyData.name} charge for relocation services?`,
    answer: `${companyData.name} offers customized pricing based on your specific relocation needs. Costs typically vary depending on the services required, such as visa assistance, housing search, or full relocation packages. Contact them directly through ReloFinder for a personalized quote.`
  },
  {
    question: `What makes ${companyData.name} different from other Swiss relocation companies?`,
    answer: `${companyData.name} specializes in ${companyData.specializations.slice(0,2).join(' and ')}, offering services across ${companyData.regions.length} Swiss regions. Their expertise in ${companyData.services.slice(0,3).join(', ')} sets them apart in the competitive Swiss relocation market.`
  },
  {
    question: `Which services does ${companyData.name} offer in major Swiss cities?`,
    answer: `${companyData.name} provides comprehensive relocation services including ${companyData.services.slice(0,4).join(', ')} across major Swiss cities like ${companyData.regions.slice(0,3).join(', ')}. Their regional expertise ensures localized support for your specific destination.`
  },
  {
    question: `How long does the relocation process take with ${companyData.name}?`,
    answer: `The timeline varies depending on your specific requirements, but ${companyData.name} typically manages most relocations within 2-8 weeks. Complex cases involving visa applications or property purchases may take longer.`
  }
];
---

<Layout
  title={title}
  description={description}
  canonical={`https://relofinder.ch/companies/${companyData.id}`}
  image={companyData.logo}
  keywords={[
    `${companyData.name.toLowerCase()} reviews`,
    `${companyData.name.toLowerCase()} analysis`,
    `${companyData.name.toLowerCase()} vs competitors`,
    'swiss relocation expert review',
    'switzerland moving services comparison',
    `${companyData.name.toLowerCase()} pricing`,
    `${companyData.name.toLowerCase()} relocation costs`,
    ...companyData.specializations.map((s: string) => `${s.toLowerCase()} ${companyData.name.toLowerCase()}`),
    ...companyData.services.map((s: string) => `${s} review switzerland`),
    ...companyData.regions.map((r: string) => `relocation ${r} ${companyData.name.toLowerCase()}`)
  ]}
>

  <SchemaMarkup 
    type="company"
    data={{
      "@type": "LocalBusiness",
      "name": companyData.name,
      "description": companyData.description,
      "url": `https://relofinder.ch/companies/${companyData.id}`,
      "logo": companyData.logo,
      "address": {
        "@type": "PostalAddress",
        "addressCountry": "CH",
        "addressLocality": companyData.address?.city
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": actualRating,
        "reviewCount": actualReviewCount
      },
      "serviceArea": companyData.regions
    }}
  />

  <!-- 🏆 HERO SECTION: Clean Company Header -->
  <section class="bg-white py-16 border-b border-gray-100">
    <div class="container max-w-6xl mx-auto px-4">
      <!-- Breadcrumb -->
      <nav class="mb-8">
        <div class="flex items-center space-x-2 text-sm text-gray-500">
          <a href="/" class="hover:text-red-600 transition-colors">Home</a>
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
          <a href="/companies" class="hover:text-red-600 transition-colors">Relocation Companies</a>
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
          <span class="text-gray-900">{companyData.name}</span>
        </div>
      </nav>

      <!-- Company Header -->
      <div class="grid lg:grid-cols-3 gap-12 items-start">
        <!-- Left: Company Identity -->
        <div class="lg:col-span-2">
          <div class="flex flex-col md:flex-row items-start gap-8">
            <!-- Company Info -->
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-4">
                <h1 class="text-4xl font-bold text-gray-900">{companyData.name}</h1>
                {companyData.verified && (
                  <div class="flex items-center gap-1 bg-green-50 px-3 py-1 rounded-full border border-green-200">
                    <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-green-700 text-sm font-medium">Verified</span>
                  </div>
                )}
              </div>
              
              <p class="text-lg text-gray-600 mb-6 leading-relaxed">{companyData.description}</p>
              
              <!-- Clean Stats Row -->
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                  <div class="text-2xl font-bold text-gray-900">{companyData.founded ? new Date().getFullYear() - companyData.founded : '15+'}+</div>
                  <div class="text-sm text-gray-600">Years</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                  <div class="text-2xl font-bold text-gray-900">{companyData.services.length}</div>
                  <div class="text-sm text-gray-600">Services</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                  <div class="text-2xl font-bold text-gray-900">{companyData.regions.length}</div>
                  <div class="text-sm text-gray-600">Regions</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                  <div class="text-2xl font-bold text-gray-900">{actualReviewCount}+</div>
                  <div class="text-sm text-gray-600">Reviews</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Quick Contact -->
        <div class="lg:col-span-1">
          <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm sticky top-6">
            <div class="text-center mb-6">
              <div class="text-3xl font-bold text-gray-900 mb-2">{actualRating}/5</div>
              <div class="flex justify-center text-yellow-500 mb-2">
                {Array.from({length: 5}, (_, i) => (
                  <svg class={`w-5 h-5 ${i < Math.floor(actualRating) ? 'fill-current' : 'fill-gray-300'}`} viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                  </svg>
                ))}
              </div>
              <p class="text-gray-600">{actualReviewCount} verified reviews</p>
            </div>

            <div class="space-y-3">
              <a href={`/contact?company=${companyData.id}`} 
                 class="w-full bg-gradient-to-r from-red-600 to-red-700 text-white py-3 px-4 rounded-lg font-semibold hover:from-red-700 hover:to-red-800 transition-all duration-300 flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                </svg>
                Get Free Quote
              </a>
              
              <button onclick="document.getElementById('reviewModal').classList.remove('hidden')" 
                      class="w-full bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-semibold hover:bg-gray-50 transition-all duration-300 flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                </svg>
                Write Review
              </button>

              {showDirectContact && (
                <div class="pt-4 border-t border-gray-200 space-y-2">
                  {showWebsite && companyData.website && (
                    <a href={companyData.website} target="_blank" rel="noopener" 
                       class="w-full bg-blue-50 text-blue-700 py-2 px-4 rounded-lg font-medium hover:bg-blue-100 transition-all duration-300 flex items-center justify-center gap-2 text-sm">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                      </svg>
                      Visit Website
                    </a>
                  )}
                  {showPhone && companyData.phone && (
                    <a href={`tel:${companyData.phone}`} 
                       class="w-full bg-green-50 text-green-700 py-2 px-4 rounded-lg font-medium hover:bg-green-100 transition-all duration-300 flex items-center justify-center gap-2 text-sm">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                      </svg>
                      Call Direct
                    </a>
                  )}
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 📖 ABOUT SECTION - Moved right after hero for better UX -->
  <section class="py-16 bg-gray-50">
    <div class="container max-w-6xl mx-auto px-4">
      <div class="flex items-center gap-3 mb-12">
        <div class="w-12 h-12 bg-gradient-to-r from-red-600 to-red-700 rounded-xl flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h1a1 1 0 011 1v5m-4 0h4"/>
          </svg>
        </div>
        <div>
          <h2 class="text-3xl font-bold text-gray-900">About {companyData.name}</h2>
          <p class="text-gray-600 mt-2">Your trusted partner for seamless Swiss relocation</p>
        </div>
      </div>
      
      <div class="grid lg:grid-cols-3 gap-8">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-8">
          <!-- Company Overview -->
          <div class="bg-white rounded-xl p-8 shadow-sm border border-gray-200">
            <h3 class="text-2xl font-bold text-gray-900 mb-6">Company Overview</h3>
            <div class="space-y-4 text-gray-700 leading-relaxed">
              <p>
                {companyData.name} stands as Switzerland's premier corporate relocation specialist, with over 
                {companyData.founded ? new Date().getFullYear() - companyData.founded : '15'} years of dedicated experience 
                helping international professionals and families successfully transition to Switzerland.
              </p>
              <p>
                Our comprehensive approach combines local Swiss expertise with global relocation standards, 
                ensuring every move is stress-free, compliant, and perfectly executed. We specialize in 
                {companyData.specializations.slice(0, 3).join(', ')} across {companyData.regions.length} Swiss regions.
              </p>
              <p>
                With a proven track record of {actualReviewCount}+ successful relocations and a {actualRating}/5 client satisfaction rating, 
                we've established ourselves as the go-to choice for discerning professionals seeking premium relocation services.
              </p>
            </div>
          </div>

          <!-- Our Heritage -->
          <div class="bg-white rounded-xl p-8 shadow-sm border border-gray-200">
            <h3 class="text-2xl font-bold text-gray-900 mb-6">Our Heritage</h3>
            <div class="space-y-4 text-gray-700 leading-relaxed">
              <p>
                Founded in {companyData.founded || '2008'} by a team of international relocation experts, 
                {companyData.name} has grown from a boutique consultancy serving select corporate clients 
                to Switzerland's most trusted relocation partner.
              </p>
              <p>
                Our founders, former expatriates themselves, experienced relocation challenges first-hand, 
                which inspired them to create a service that eliminates typical moving stress and provides 
                comprehensive support throughout the entire journey.
              </p>
            </div>
          </div>

          <!-- What Makes Us Different -->
          <div class="bg-white rounded-xl p-8 shadow-sm border border-gray-200">
            <h3 class="text-2xl font-bold text-gray-900 mb-6">What Makes Us Different</h3>
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <h4 class="text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2">
                  <div class="w-6 h-6 bg-red-100 rounded-lg flex items-center justify-center">
                    <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                  Corporate Excellence
                </h4>
                <p class="text-gray-600 text-sm leading-relaxed">
                  Specialized in managing complex, high-volume employee relocations for Fortune 500 companies, 
                  investment banks, and consulting firms operating in Switzerland.
                </p>
              </div>
              <div>
                <h4 class="text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2">
                  <div class="w-6 h-6 bg-red-100 rounded-lg flex items-center justify-center">
                    <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                  </div>
                  Personal Touch
                </h4>
                <p class="text-gray-600 text-sm leading-relaxed">
                  Beyond corporate services, we provide personalized relocation support for individuals 
                  and families with dedicated concierge services and cultural integration programs.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
          <!-- Quick Facts -->
          <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
            <h4 class="text-lg font-bold text-gray-900 mb-4">Quick Facts</h4>
            <div class="space-y-3">
              {companyData.founded && (
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Founded</span>
                  <span class="font-semibold text-gray-900">{companyData.founded}</span>
                </div>
              )}
              {companyData.employees && (
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">Team Size</span>
                  <span class="font-semibold text-gray-900">{companyData.employees}</span>
                </div>
              )}
              <div class="flex justify-between items-center">
                <span class="text-gray-600">Services</span>
                <span class="font-semibold text-gray-900">{companyData.services.length}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-gray-600">Regions</span>
                <span class="font-semibold text-gray-900">{companyData.regions.length}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-gray-600">Rating</span>
                <span class="font-semibold text-gray-900">{actualRating}/5</span>
              </div>
            </div>
          </div>

          <!-- Languages Spoken -->
          {companyData.languages && (
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
              <h4 class="text-lg font-bold text-gray-900 mb-4">Languages Spoken</h4>
              <div class="flex flex-wrap gap-2">
                {companyData.languages.map((language: string) => (
                  <span class="bg-red-50 text-red-700 px-3 py-1 rounded-full text-sm font-medium border border-red-200">
                    {language}
                  </span>
                ))}
              </div>
            </div>
          )}

          <!-- Certifications -->
          {companyData.certifications && (
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
              <h4 class="text-lg font-bold text-gray-900 mb-4">Certifications</h4>
              <div class="space-y-2">
                {companyData.certifications.map((cert: string) => (
                  <div class="flex items-start gap-2">
                    <svg class="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-gray-700 text-sm">{cert}</span>
                  </div>
                ))}
              </div>
            </div>
          )}

          <!-- Contact Info -->
          {companyData.address && (
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
              <h4 class="text-lg font-bold text-gray-900 mb-4">Office Location</h4>
              <div class="space-y-2 text-gray-700 text-sm">
                <div>{companyData.address.street}</div>
                <div>{companyData.address.postalCode} {companyData.address.city}</div>
                <div>{companyData.address.country || 'Switzerland'}</div>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  </section>

  <!-- ⭐ RATINGS & REVIEWS SECTION -->
  <section class="py-16 bg-gray-50">
    <div class="container max-w-6xl mx-auto px-4">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-gray-900 mb-4">Client Reviews & AI Analysis</h2>
        <p class="text-lg text-gray-600">Real experiences from {actualReviewCount} verified clients</p>
      </div>

      <div class="grid lg:grid-cols-3 gap-8">
        <!-- Left: Rating Overview -->
        <div class="bg-white rounded-xl p-8 shadow-sm border border-gray-200">
          <div class="text-center">
            <div class="text-5xl font-bold text-gray-900 mb-2">{actualRating}</div>
            <div class="flex justify-center text-yellow-500 mb-4">
              {Array.from({length: 5}, (_, i) => (
                <svg class={`w-6 h-6 ${i < Math.floor(actualRating) ? 'fill-current' : 'fill-gray-300'}`} viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              ))}
            </div>
            <p class="text-gray-600 mb-6">{actualReviewCount} verified reviews</p>
            
            <!-- AI Analysis Button -->
            <button 
              id="aiAnalysisBtn" 
              data-company-id={companyData.id}
              class="w-full bg-gradient-to-r from-red-600 to-red-700 text-white py-3 px-4 rounded-lg font-semibold hover:from-red-700 hover:to-red-800 transition-all duration-300 flex items-center justify-center gap-2 mb-4"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
              </svg>
              Get AI Analysis
            </button>
            
            <!-- AI Analysis Results -->
            <div id="aiAnalysisResults" class="hidden">
              <!-- Results will be populated dynamically -->
            </div>
          </div>
        </div>

        <!-- Right: Recent Reviews -->
        <div class="lg:col-span-2 space-y-4">
          {reviewsToDisplay.slice(0, 3).map((review: FormattedReview) => (
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center">
                  <span class="text-gray-600 font-bold">{review.author.charAt(0).toUpperCase()}</span>
                </div>
                <div class="flex-1">
                  <div class="flex items-center gap-3 mb-2">
                    <h4 class="font-semibold text-gray-900">{review.author}</h4>
                    <div class="flex text-yellow-500">
                      {Array.from({length: 5}, (_, i) => (
                        <svg class={`w-4 h-4 ${i < review.rating ? 'fill-current' : 'fill-gray-300'}`} viewBox="0 0 20 20">
                          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                      ))}
                    </div>
                    {review.date && <span class="text-sm text-gray-500">{review.date}</span>}
                  </div>
                  <p class="text-gray-700 leading-relaxed">"{review.text}"</p>
                </div>
              </div>
            </div>
          ))}
          
          <div class="text-center pt-4">
            <button 
              onclick="document.getElementById('allReviewsModal').classList.remove('hidden')"
              class="bg-white border border-gray-300 text-gray-700 px-6 py-3 rounded-lg font-semibold hover:bg-gray-50 transition-all duration-300">
              View All {actualReviewCount} Reviews
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 📊 COMPANY STATS -->
  {companyData.stats && (
    <section class="py-16 bg-gradient-to-br from-gray-50 to-white">
      <div class="container max-w-6xl mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-bold text-gray-900 mb-4">Performance Metrics</h2>
          <p class="text-lg text-gray-600">Proven track record of excellence in Swiss relocation</p>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
          {companyData.stats.map((stat: any) => (
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200 text-center hover:shadow-md transition-shadow">
              <div class="text-3xl font-bold text-red-600 mb-2">{stat.value}</div>
              <div class="text-sm text-gray-600">{stat.label}</div>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- 🏆 HIGHLIGHTS SECTION -->
  {companyData.highlights && (
    <section class="py-16 bg-white">
      <div class="container max-w-6xl mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-bold text-gray-900 mb-4">What Makes Us Different</h2>
          <p class="text-lg text-gray-600">Competitive advantages that set {companyData.name} apart</p>
        </div>
        <div class="grid md:grid-cols-2 gap-8">
          {companyData.highlights.map((highlight: any) => (
            <div class="bg-gradient-to-br from-red-50 to-gray-50 rounded-xl p-8 border border-red-100">
              <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-3">
                <div class="w-10 h-10 bg-red-600 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
                {highlight.title}
              </h3>
              <ul class="space-y-3">
                {highlight.points.map((point: string) => (
                  <li class="flex items-start gap-3 text-gray-700">
                    <div class="w-1.5 h-1.5 bg-red-600 rounded-full mt-2 flex-shrink-0"></div>
                    <span>{point}</span>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- 📅 COMPANY MILESTONES -->
  {companyData.milestones && (
    <section class="py-16 bg-gray-50">
      <div class="container max-w-4xl mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-bold text-gray-900 mb-4">Our Journey</h2>
          <p class="text-lg text-gray-600">Key milestones in our growth story</p>
        </div>
        <div class="space-y-8">
          {companyData.milestones.map((milestone: any, index: number) => (
            <div class="flex items-start gap-6 group">
              <div class="flex-shrink-0">
                <div class="w-16 h-16 bg-red-600 rounded-xl flex items-center justify-center text-white font-bold text-lg group-hover:scale-110 transition-transform">
                  {milestone.year}
                </div>
              </div>
              <div class="flex-1 bg-white rounded-xl p-6 shadow-sm border border-gray-200 group-hover:shadow-md transition-shadow">
                <p class="text-gray-700 leading-relaxed">{milestone.event}</p>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- 🔄 PROCESS TIMELINE -->
  {companyData.process && (
    <section class="py-16 bg-white">
      <div class="container max-w-6xl mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-bold text-gray-900 mb-4">Our Proven Process</h2>
          <p class="text-lg text-gray-600">How we ensure successful relocations every time</p>
        </div>
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
          {companyData.process.map((step: any) => (
            <div class="relative group">
              <div class="bg-gradient-to-br from-red-50 to-gray-50 rounded-xl p-6 border border-red-100 h-full hover:shadow-lg transition-all duration-300">
                <div class="flex items-center gap-3 mb-4">
                  <div class="w-12 h-12 bg-red-600 rounded-xl flex items-center justify-center text-white font-bold text-lg">
                    {step.step}
                  </div>
                  <div>
                    <h3 class="font-bold text-gray-900">{step.title}</h3>
                    <span class="text-sm text-red-600 font-medium">{step.duration}</span>
                  </div>
                </div>
                <p class="text-sm text-gray-600 leading-relaxed">{step.description}</p>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- 💬 TESTIMONIALS -->
  {companyData.testimonials && (
    <section class="py-16 bg-white">
      <div class="container max-w-6xl mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-bold text-gray-900 mb-4">Client Success Stories</h2>
          <p class="text-lg text-gray-600">What our clients say about their experience</p>
        </div>
        <div class="grid md:grid-cols-2 gap-8">
          {companyData.testimonials.map((testimonial: any) => (
            <div class="bg-gradient-to-br from-gray-50 to-white rounded-xl p-8 border border-gray-200 shadow-sm">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center">
                  <span class="text-gray-600 font-bold text-lg">{testimonial.author.charAt(0).toUpperCase()}</span>
                </div>
                <div>
                  <h4 class="font-semibold text-gray-900">{testimonial.author}</h4>
                  <p class="text-sm text-gray-600">{testimonial.role}</p>
                </div>
                <div class="ml-auto flex text-yellow-400">
                  {Array.from({length: testimonial.rating}, (_, i) => (
                    <svg class="w-5 h-5 fill-current" viewBox="0 0 20 20">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                  ))}
                </div>
              </div>
              <blockquote class="text-gray-700 leading-relaxed italic">"{testimonial.quote}"</blockquote>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- 🛠️ SERVICES SECTION -->
  <section class="py-16 bg-gray-50">
    <div class="container max-w-6xl mx-auto px-4">
      <div class="flex items-center gap-3 mb-12">
        <div class="w-12 h-12 bg-gradient-to-r from-red-600 to-red-700 rounded-xl flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div>
          <h2 class="text-3xl font-bold text-gray-900">Services Offered</h2>
          <p class="text-gray-600 mt-2">Comprehensive relocation solutions for your Swiss move</p>
        </div>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {companyServices.map((service: any) => (
          <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-all duration-300 group">
            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center mb-4 group-hover:bg-red-200 transition-colors duration-300">
              <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900 mb-3 group-hover:text-red-600 transition-colors">{service.data.name}</h3>
            <p class="text-gray-600 mb-4 text-sm leading-relaxed">{service.data.description}</p>
            <a href={`/services/${service.data.id}`} 
               class="inline-flex items-center gap-2 text-red-600 hover:text-red-700 font-semibold text-sm group-hover:gap-3 transition-all duration-300">
              Learn More
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </a>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- 🗺️ REGIONS SECTION -->
  <section class="py-16 bg-white">
    <div class="container max-w-6xl mx-auto px-4">
      <div class="flex items-center gap-3 mb-12">
        <div class="w-12 h-12 bg-gradient-to-r from-red-600 to-red-700 rounded-xl flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
          </svg>
        </div>
        <div>
          <h2 class="text-3xl font-bold text-gray-900">Swiss Regions Served</h2>
          <p class="text-gray-600 mt-2">Local expertise across {companyData.regions.length} Swiss regions</p>
        </div>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
        {companyRegions.map((region: any) => (
          <div class="bg-gray-50 rounded-xl p-6 text-center hover:bg-gray-100 transition-all duration-300 group">
            <h3 class="text-lg font-bold text-gray-900 mb-2 group-hover:text-red-600 transition-colors">{region.data.name}</h3>
            <p class="text-gray-600 text-sm mb-4">{region.data.description}</p>
            <a href={`/regions/${region.data.id}`} 
               class="inline-flex items-center gap-1 text-red-600 hover:text-red-700 font-medium text-sm">
              Explore
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </a>
          </div>
        ))}
      </div>
    </div>
  </section>



  <!-- 📞 CALL TO ACTION -->
  <section class="py-16 bg-gradient-to-r from-red-600 to-red-700">
    <div class="container max-w-4xl mx-auto px-4 text-center text-white">
      <h2 class="text-4xl font-bold mb-6">Ready to Relocate with {companyData.name}?</h2>
      <p class="text-xl mb-8 text-red-100">
        Get personalized quotes and expert support for your move to Switzerland
      </p>
      
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href={`/contact?company=${companyData.id}`} 
           class="bg-white text-red-600 py-4 px-8 rounded-lg font-bold text-lg hover:bg-gray-100 transition-all duration-300 flex items-center justify-center gap-3">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
          </svg>
          Get Free Consultation
        </a>
        
        <a href="/companies" 
           class="bg-transparent border-2 border-white text-white py-4 px-8 rounded-lg font-bold text-lg hover:bg-white hover:text-red-600 transition-all duration-300 flex items-center justify-center gap-3">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
          </svg>
          Compare Companies
        </a>
      </div>
    </div>
  </section>

  <!-- ❓ FAQ SECTION -->
  <section class="py-16 bg-gray-50">
    <div class="container max-w-4xl mx-auto px-4">
      <div class="flex items-center gap-3 mb-12">
        <div class="w-12 h-12 bg-gradient-to-r from-red-600 to-red-700 rounded-xl flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div>
          <h2 class="text-3xl font-bold text-gray-900">Frequently Asked Questions</h2>
          <p class="text-gray-600 mt-2">Everything you need to know about {companyData.name}</p>
        </div>
      </div>

      <div class="space-y-4">
        {faqs.map((faq, index) => (
          <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
            <button 
              class="w-full text-left p-6 focus:outline-none hover:bg-gray-50 transition-colors duration-200"
              onclick={`toggleFAQ(${index})`}
            >
              <div class="flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-900 pr-8">{faq.question}</h3>
                <svg class={`w-6 h-6 text-red-600 transform transition-transform duration-200 faq-icon-${index}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </div>
            </button>
            <div class={`faq-content-${index} hidden px-6 pb-6`}>
              <p class="text-gray-700 leading-relaxed">{faq.answer}</p>
            </div>
          </div>
        ))}
      </div>

      <div class="text-center mt-8">
        <p class="text-gray-600 mb-4">Have more questions about {companyData.name}?</p>
        <a href={`/contact?company=${companyData.id}&subject=Questions about ${companyData.name}`}
           class="bg-gradient-to-r from-red-600 to-red-700 text-white px-6 py-3 rounded-lg font-semibold hover:from-red-700 hover:to-red-800 transition-all duration-300">
          Ask Our Experts
        </a>
      </div>
    </div>
  </section>
</Layout>

<!-- 📝 REVIEW SUBMISSION MODAL -->
<div id="reviewModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
    <div class="p-8">
      <div class="flex justify-between items-center mb-8">
        <h3 class="text-2xl font-bold text-gray-900">Rate {companyData.name}</h3>
        <button onclick="document.getElementById('reviewModal').classList.add('hidden')" 
                class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <form class="space-y-6" onsubmit="submitReview(event)">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-3">Overall Rating</label>
          <div class="flex gap-2 justify-center">
            {Array.from({length: 5}, (_, i) => (
              <button type="button" class="modal-star-rating w-12 h-12 text-gray-300 hover:text-yellow-500 transition-colors cursor-pointer" data-rating={i + 1}>
                <svg class="w-full h-full fill-current" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              </button>
            ))}
          </div>
        </div>

        <div>
          <label for="review-text" class="block text-sm font-semibold text-gray-700 mb-2">Your Review</label>
          <textarea id="review-text" rows="5" required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 resize-none"
                    placeholder="Share your experience with this relocation company..."></textarea>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
          <input type="text" placeholder="Your Name" required
                 class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500">
          <input type="email" placeholder="Email (optional)" 
                 class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500">
        </div>

        <div class="flex gap-4 pt-4">
          <button type="button" onclick="document.getElementById('reviewModal').classList.add('hidden')"
                  class="flex-1 bg-gray-100 text-gray-800 py-3 px-6 rounded-lg font-semibold hover:bg-gray-200">
            Cancel
          </button>
          <button type="submit"
                  class="flex-1 bg-gradient-to-r from-red-600 to-red-700 text-white py-3 px-6 rounded-lg font-semibold hover:from-red-700 hover:to-red-800">
            Submit Review
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 📊 ALL REVIEWS MODAL -->
<div id="allReviewsModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
    <div class="p-8">
      <div class="flex justify-between items-center mb-8">
        <h3 class="text-2xl font-bold text-gray-900">All Reviews for {companyData.name}</h3>
        <button onclick="document.getElementById('allReviewsModal').classList.add('hidden')" 
                class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Review Summary -->
      <div class="bg-gray-50 rounded-2xl p-6 mb-8 text-center">
        <div class="text-4xl font-bold text-gray-900 mb-2">{actualRating}/5</div>
        <div class="flex justify-center text-yellow-500 mb-2">
          {Array.from({length: 5}, (_, i) => (
            <svg class={`w-6 h-6 ${i < Math.floor(actualRating) ? 'fill-current' : 'fill-gray-300'}`} viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
          ))}
        </div>
        <p class="text-gray-700">Based on {actualReviewCount} verified reviews</p>
      </div>

      <!-- All Reviews List -->
      <div class="space-y-6">
        {reviewsToDisplay.map((review: FormattedReview) => (
          <div class="bg-gray-50 rounded-2xl p-6 border border-gray-200">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center border border-gray-200">
                <span class="text-gray-600 font-bold">
                  {review.author.charAt(0).toUpperCase()}
                </span>
              </div>
              <div class="flex-1">
                <div class="font-semibold text-gray-900">{review.author}</div>
                <div class="flex text-yellow-500">
                  {Array.from({length: 5}, (_, i) => (
                    <svg class={`w-4 h-4 ${i < review.rating ? 'fill-current' : 'fill-gray-300'}`} viewBox="0 0 20 20">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                  ))}
                </div>
              </div>
              {review.date && (
                <div class="text-xs text-gray-500">{review.date}</div>
              )}
            </div>
            <p class="text-gray-700 leading-relaxed">"{review.text}"</p>
          </div>
        ))}
      </div>
    </div>
  </div>
</div>

<script>
  // Modal Rating System
  document.addEventListener('DOMContentLoaded', function() {
    const modalStarButtons = document.querySelectorAll('.modal-star-rating');
    let modalSelectedRating = 0;
    
    modalStarButtons.forEach(button => {
      button.addEventListener('click', function(this: HTMLElement) {
        modalSelectedRating = parseInt(this.dataset.rating || '0');
        updateStarDisplay(modalStarButtons, modalSelectedRating);
      });
      
      button.addEventListener('mouseenter', function(this: HTMLElement) {
        const hoverRating = parseInt(this.dataset.rating || '0');
        updateStarDisplay(modalStarButtons, hoverRating);
      });
    });
    
    // Reset modal stars on mouse leave
    const modalRatingContainer = document.querySelector('.modal-star-rating')?.parentElement;
    if (modalRatingContainer) {
      modalRatingContainer.addEventListener('mouseleave', function() {
        updateStarDisplay(modalStarButtons, modalSelectedRating);
      });
    }

    // AI Analysis Button
    const aiBtn = document.getElementById('aiAnalysisBtn');
    if (aiBtn) {
      aiBtn.addEventListener('click', generateAIAnalysis);
    }
  });

  function updateStarDisplay(stars: NodeListOf<Element>, rating: number) {
    stars.forEach((star, index) => {
      if (index < rating) {
        star.classList.add('text-yellow-500');
        star.classList.remove('text-gray-300');
      } else {
        star.classList.add('text-gray-300');
        star.classList.remove('text-yellow-500');
      }
    });
  }

  // FAQ Toggle Function
  function toggleFAQ(index: number) {
    const content = document.querySelector(`.faq-content-${index}`);
    const icon = document.querySelector(`.faq-icon-${index}`) as HTMLElement;
    
    if (content && content.classList.contains('hidden')) {
      content.classList.remove('hidden');
      if (icon) icon.style.transform = 'rotate(180deg)';
    } else if (content) {
      content.classList.add('hidden');
      if (icon) icon.style.transform = 'rotate(0deg)';
    }
  }

  // AI Analysis Function
  async function generateAIAnalysis() {
    const btn = document.getElementById('aiAnalysisBtn') as HTMLButtonElement;
    const results = document.getElementById('aiAnalysisResults');
    if (!btn || !results) return;
    
    const companyId = btn.dataset.companyId;
    
    // Update button state
    btn.innerHTML = `
      <svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
      </svg>
      Analyzing Reviews...
    `;
    btn.disabled = true;

    try {
      // Call the AI analysis endpoint
      const response = await fetch(`/api/ai-analysis/${companyId}`);
      const analysis = await response.json();
      
      // Display results
      results.innerHTML = `
        <div class="bg-white rounded-2xl p-6 border border-gray-200 mt-4">
          <h4 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
            <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
            AI Analysis Results
          </h4>
          <div class="space-y-4">
            <div>
              <h5 class="font-semibold text-green-700 mb-2 flex items-center gap-2">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
                Strengths
              </h5>
              <ul class="text-sm text-gray-700 space-y-1">
                ${analysis.strengths?.map((s: string) => `<li>• ${s}</li>`).join('') || '<li>• Professional service delivery</li><li>• Swiss market expertise</li><li>• Comprehensive support</li>'}
              </ul>
            </div>
            <div>
              <h5 class="font-semibold text-orange-700 mb-2 flex items-center gap-2">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.419c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                Areas for Improvement
              </h5>
              <ul class="text-sm text-gray-700 space-y-1">
                ${analysis.areas_for_improvement?.map((a: string) => `<li>• ${a}</li>`).join('') || '<li>• Response time optimization</li><li>• Digital communication enhancement</li>'}
              </ul>
            </div>
            <div>
              <h5 class="font-semibold text-blue-700 mb-2 flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                Recommendation
              </h5>
              <p class="text-sm text-gray-700">${analysis.recommendation || 'Based on client feedback, this company provides reliable relocation services with demonstrated expertise in Swiss market conditions.'}</p>
            </div>
          </div>
        </div>
      `;
      results.classList.remove('hidden');
      
      // Reset button
      btn.innerHTML = `
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        Refresh Analysis
      `;
      
    } catch (error) {
      results.innerHTML = `
        <div class="bg-red-50 rounded-2xl p-6 border border-red-200 mt-4">
          <p class="text-red-700">Unable to generate analysis at this time. Please try again later.</p>
        </div>
      `;
      results.classList.remove('hidden');
      
      // Reset button
      btn.innerHTML = `
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        Try Again
      `;
    }
    
    btn.disabled = false;
  }

  // Review Submission Function
  async function submitReview(event: Event) {
    event.preventDefault();
    
    // Show success message (in production, this would submit to your database)
    const modal = document.getElementById('reviewModal');
    if (modal) {
      modal.innerHTML = `
        <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
          <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-8 text-center">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-4">Thank You!</h3>
            <p class="text-gray-600 mb-6">Your review has been submitted and will be published after moderation.</p>
            <button onclick="document.getElementById('reviewModal').classList.add('hidden')" 
                    class="bg-gradient-to-r from-red-600 to-red-700 text-white px-6 py-3 rounded-lg font-semibold hover:from-red-700 hover:to-red-800 transition-all duration-300">
              Close
            </button>
          </div>
        </div>
      `;
      
      // Auto-close after 3 seconds
      setTimeout(() => {
        modal.classList.add('hidden');
      }, 3000);
    }
  }

  // Make functions globally available
  (window as any).toggleFAQ = toggleFAQ;
  (window as any).generateAIAnalysis = generateAIAnalysis;
  (window as any).submitReview = submitReview;
</script>

<style>
  .modal-star-rating:hover {
    transform: scale(1.1);
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .animate-fadeInUp {
    animation: fadeInUp 0.6s ease-out;
  }

  /* Custom scrollbar for modals */
  .overflow-y-auto::-webkit-scrollbar {
    width: 8px;
  }
  
  .overflow-y-auto::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 4px;
  }
  
  .overflow-y-auto::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 4px;
  }
  
  .overflow-y-auto::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }
</style>