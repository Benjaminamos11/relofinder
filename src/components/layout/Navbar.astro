---
import { IconBuilding, IconLock, IconMenu, IconX } from './NavIcons';

const currentPath = Astro.url.pathname;
function isActive(path: string) {
  return currentPath === path || currentPath.startsWith(path + '/');
}

const { variant = 'transparent' } = Astro.props;

// Determine initial classes based on variant
const initialHeaderClass = variant === 'solid' 
  ? 'bg-white/95 backdrop-blur-sm border-gray-200 shadow-sm'
  : 'bg-transparent border-transparent';

const initialLogoClass = variant === 'solid' ? 'text-[#FF6F61]' : 'text-[#FF6F61]'; // Always orange as per previous request, but good to be explicit
const initialToggleClass = variant === 'solid' ? 'text-slate-600' : 'text-white';
// For solid variant, we want links visible immediately
const initialNavOpacity = variant === 'solid' ? '' : 'opacity-0 translate-y-[-10px] pointer-events-none';
---

<header 
  id="main-navbar" 
  class={`fixed top-0 left-0 right-0 z-50 transition-all duration-300 border-b ${initialHeaderClass}`}
  data-scroll-state={variant === 'solid' ? 'scrolled' : 'top'}
  data-variant={variant}
>
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-20">
      
      <!-- 1. Left: Logo -->
      <div class="flex-shrink-0 flex items-center">
        <a href="/" class="text-2xl font-bold tracking-tight transition-opacity hover:opacity-90 transition-colors duration-300 logo-text text-[#FF6F61]" style="font-family: 'Playfair Display', serif;">
          Relofinder
        </a>
      </div>

      <!-- 2. Center: User Navigation (Desktop) -->
      <nav class={`hidden md:flex items-center gap-8 nav-links transition-all duration-500 ${initialNavOpacity}`}>
        <a 
          href="/companies" 
          class={`text-sm font-medium transition-colors duration-200 ${isActive('/companies') ? 'text-[#FF6F61]' : 'text-slate-600 hover:text-[#FF6F61]'}`}
        >
          Directory
        </a>
        <a 
          href="/blog" 
          class={`text-sm font-medium transition-colors duration-200 ${isActive('/blog') ? 'text-[#FF6F61]' : 'text-slate-600 hover:text-[#FF6F61]'}`}
        >
          Journal
        </a>
      </nav>

      <!-- 3. Right: Professional Actions (Desktop) -->
      <div class={`hidden md:flex items-center gap-6 nav-actions transition-all duration-500 ${initialNavOpacity}`}>
        <!-- Divider -->
        <div class="h-6 w-px bg-slate-200 divider"></div>
        
        <!-- Agency Login -->
        <a 
          href="/login" 
          class="flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-[#FF6F61] transition-colors"
        >
          <IconLock className="w-4 h-4" />
          <span>Agency Login</span>
        </a>
        
        <!-- Corporate HR Button -->
        <a 
          href="/corporate" 
          class="bg-slate-900 text-white text-sm font-medium px-5 py-2.5 rounded-lg hover:bg-slate-800 transition-all shadow-md hover:shadow-lg flex items-center gap-2"
        >
          <IconBuilding className="w-4 h-4" />
          <span>For Corporate HR</span>
        </a>
      </div>

      <!-- Mobile Menu Toggle -->
      <button 
        id="mobile-menu-btn"
        class="md:hidden p-2 text-white hover:text-slate-200 transition-colors mobile-toggle"
        aria-label="Toggle menu"
      >
        <IconMenu className="w-6 h-6" id="menu-icon-open" />
        <IconX className="w-6 h-6 hidden" id="menu-icon-close" />
      </button>

    </div>
  </div>

</header>

<!-- Mobile Menu Overlay -->
<div 
  id="mobile-overlay" 
  class="fixed inset-0 bg-slate-900/50 z-[60] opacity-0 pointer-events-none transition-opacity duration-300 md:hidden backdrop-blur-sm"
  aria-hidden="true"
></div>

<!-- Mobile Drawer -->
<div 
  id="mobile-drawer"
  class="fixed top-0 right-0 bottom-0 w-[80%] max-w-sm bg-white z-[70] transform translate-x-full transition-transform duration-300 md:hidden shadow-2xl flex flex-col pt-20"
>
  <!-- Close Button (Absolute Top Right) -->
  <button 
    id="mobile-drawer-close"
    class="absolute top-5 right-4 p-2 text-slate-400 hover:text-slate-600 transition-colors"
  >
    <IconX className="w-6 h-6" />
  </button>

  <div class="flex-1 overflow-y-auto px-6 pb-6">
    
    <!-- Section: Individuals -->
    <div class="mb-8">
      <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Individuals</h3>
      <nav class="flex flex-col gap-1">
        <a href="/companies" class="py-3 text-lg font-medium text-slate-800 border-b border-slate-100 hover:text-[#FF6F61]">
          Directory
        </a>
        <a href="/blog" class="py-3 text-lg font-medium text-slate-800 border-b border-slate-100 hover:text-[#FF6F61]">
          Journal
        </a>
      </nav>
    </div>

    <!-- Section: Partners -->
    <div>
      <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Partners</h3>
      <nav class="flex flex-col gap-4">
        <a href="/contact" class="flex items-center gap-3 py-2 text-slate-600 hover:text-[#FF6F61] font-medium">
          <IconLock className="w-4 h-4" />
          Agency Login
        </a>
        <a href="/corporate" class="flex items-center justify-center gap-2 w-full bg-slate-900 text-white font-medium py-3 rounded-lg shadow-sm">
          <IconBuilding className="w-4 h-4" />
          For Corporate HR
        </a>
      </nav>
    </div>
  </div>
</div>

<script is:inline>
  // Elements
  const navbar = document.getElementById('main-navbar');
  const logoText = navbar.querySelector('.logo-text');
  const navLinks = navbar.querySelector('.nav-links');
  const navActions = navbar.querySelector('.nav-actions');
  const mobileToggle = navbar.querySelector('.mobile-toggle');

  // Mobile Menu Logic
  const menuBtn = document.getElementById('mobile-menu-btn');
  const drawerCloseBtn = document.getElementById('mobile-drawer-close');
  const drawer = document.getElementById('mobile-drawer');
  const overlay = document.getElementById('mobile-overlay');

  function toggleMenu() {
    const isClosed = drawer.classList.contains('translate-x-full');
    if (isClosed) {
      drawer.classList.remove('translate-x-full');
      overlay.classList.remove('opacity-0', 'pointer-events-none');
      document.body.style.overflow = 'hidden';
    } else {
      drawer.classList.add('translate-x-full');
      overlay.classList.add('opacity-0', 'pointer-events-none');
      document.body.style.overflow = '';
    }
  }

  menuBtn?.addEventListener('click', toggleMenu);
  drawerCloseBtn?.addEventListener('click', toggleMenu);
  overlay?.addEventListener('click', toggleMenu);
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !drawer.classList.contains('translate-x-full')) toggleMenu();
  });

  // Scroll Logic
  function handleScroll() {
    // If fixed solid variant, don't change styles on scroll
    if (navbar.getAttribute('data-variant') === 'solid') return;

    if (window.scrollY > 50) {
      // Scrolled State
      if (navbar.getAttribute('data-scroll-state') === 'scrolled') return;
      
      navbar.setAttribute('data-scroll-state', 'scrolled');
      
      // Navbar Container
      navbar.classList.remove('bg-transparent', 'border-transparent');
      navbar.classList.add('bg-white/95', 'backdrop-blur-sm', 'border-gray-200', 'shadow-sm');
      
      // Logo Color
      // logoText.classList.remove('text-white');
      // logoText.classList.add('text-[#FF6F61]');

      // Mobile Toggle Color
      mobileToggle.classList.remove('text-white');
      mobileToggle.classList.add('text-slate-600');

      // Show Links & Actions ("All Comes")
      navLinks.classList.remove('opacity-0', 'translate-y-[-10px]', 'pointer-events-none');
      navActions.classList.remove('opacity-0', 'translate-y-[-10px]', 'pointer-events-none');

    } else {
      // Top State
      if (navbar.getAttribute('data-scroll-state') === 'top') return;
      
      navbar.setAttribute('data-scroll-state', 'top');
      
      // Navbar Container
      navbar.classList.add('bg-transparent', 'border-transparent');
      navbar.classList.remove('bg-white/95', 'backdrop-blur-sm', 'border-gray-200', 'shadow-sm');
      
      // Logo Color - Always Orange as per user request
      // logoText.classList.add('text-white');
      // logoText.classList.remove('text-[#FF6F61]');

      // Mobile Toggle Color
      mobileToggle.classList.add('text-white');
      mobileToggle.classList.remove('text-slate-600');

      // Hide Links & Actions ("Only show the logo in the beginning")
      navLinks.classList.add('opacity-0', 'translate-y-[-10px]', 'pointer-events-none');
      navActions.classList.add('opacity-0', 'translate-y-[-10px]', 'pointer-events-none');
    }
  }

  window.addEventListener('scroll', handleScroll, { passive: true });
  // Init
  handleScroll();
</script>
